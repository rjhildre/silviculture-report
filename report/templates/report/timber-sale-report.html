{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130356984-1"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-130356984-1');
        </script>

        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Timber Sale Activity Report</title>
       
        <!-- Custom CSS -->
        <link rel="stylesheet" href="{% static 'report/style.css' %}" type="text/css">
    </head>

    <body>
        <!-- ----------------------------- HEADER--------------------------------->
        <!-- This was the cover page that I adapted from Zak's origional report. Removed per Eric Aubert.  -->
       <!--  <div class="container-fluid">
            <div class="break-after">
            <div class="row justify-content-sm-center">
                    <div class="col-sm-8"><img style="width:100%" class="img-fluid" src="C:\apps\silvreport\report\static\report\images\em_dnr_logo_2_color_long_PNG.png" alt="DNR Logo"></div>
            </div>
            <div class="row justify-content-sm-center page-break-after">
                <div class="col-sm-8"><h2 style="text-align:center">Forest Management Activities (FMAs) Report<br>including information of overlapping FMAs
                <br>for {{ timber_sale|title }} Timber Sale</h2>
            </div>
            </div>
            </div> -->
            <!-------------------------------------TIMBER SALE FMAS-------------------------------->
            <!--Loop through the fma_details dictionary. -->
            {% for k, v in fma_details.items %}
            <div>
                <div class="break-after"><!--Break-after class gives us a page break after this section-->
                <div id="fma-header">
                    <div class="row justify-content-sm-center" id="fma-activity"><h4>Activity Information for FMA: {{ k }}</h4></div>
                    <div class="row">
                        <div class="col-sm-3">Activity ID: <strong>{{ v.fma_id }}</strong></div>
                        <div class="col-sm-3">Status: <strong>{{ v.fma_status }}</strong></div>
                        <div class="col-sm-3">Type: <strong>{{ v.fma_type }}</strong></div>
                        <div class="col-sm-3">Technique: <strong>{{ v.fma_technique }}</strong></div>
                    </div>
                    <div class="row">
                            <div class="col-sm-3">Activity Date: <strong>{{ v.fma_date|date:"SHORT_DATE_FORMAT" }}</strong></div>
                            <div class="col-sm-3">Acres: <strong>{{ v.fma_acres_treated|floatformat:2 }}</strong></div>
                            <div class="col-sm-3">Crew: <strong>{{ v.fma_crew }}</strong></div>
                            <div class="col-sm_3"> TS ID: <strong>{{ v.ts_id }}</strong></div>
                    </div>
                    <div class="row">
                            <div class="col-sm-3">Region: <strong>{{ v.fma_region }}</strong></div>
                            <div class="col-sm-3">District: <strong>{{ v.fma_district }}</strong></div>
                            <div class="col-sm-3">Admin: <strong>{{ v.fma_admin }}</strong></div>
                            <div class="col-sm-3" id="timber-sale">TS Name: <strong>{{ v.ts_name }}</strong></div>
                    </div>
                </div>
                <div id="fma-body">
                    <div>
                        <strong>Silvicultural Prescription:</strong>
                        {{ v.harvest_comments|linebreaks }}
                    </div>
                    {% if v.fma_comments != 'None' %}
                    <div>
                        Comments:
                        {{ v.fma_comments|linebreaks }}
                    </div>
                    {% endif %}
                </div>
                </div>
                <!------------------------------------------OVERLAPPING FMAS---------------------------->
                <div class="break-after" id="overlapping-fmas">
                    <div>
                        <div class="row  avoid-break"><!--avoid-break class keeps this content from splitting on print media-->
                            <div class="col-sm-12" id="overlapping-activities"><h4>Overlapping Activities &gt; 0.25 Acres:</h4></div>
                        </div>
                        <div class="row avoid-break" id = "fma-header" >
                            <div class="col-sm-1" id="overlap-header">ID</div>
                            <div class="col-sm-2" id="overlap-header">Name</div>
                            <div class="col-sm-2" id="overlap-header">Type</div>
                            <div class="col-sm-2" id="overlap-header">Technique</div>
                            <div class="col-sm-1" id="overlap-header">Date</div>
                            <div class="col-sm-2" id="overlap-header">Status</div>
                            <div class="col-sm-2" id="overlap-header">Overlap Acres</div>
                        </div>
                    </div>
                    <!--Loop through list of overlapping_fmas-->
                    {% for fma, overlap_fma, fma_nm, fma_type, fma_tech, fma_date, fma_status, acres, comments in overlapping_fmas %}
                    {% if fma == v.fma_id and overlap_fma != v.fma_id %}<!--Make sure the list of overlapping fmas does not include the fma itself-->
                    <div class="avoid-break">
                    <div class="row" id="overlap-detail"> 
                        <div class="col-sm-1">{{ overlap_fma }}</div>
                        <div class="col-sm-2">{{ fma_nm }}</div>
                        <div class="col-sm-2">{{ fma_type }}</div>
                        <div class="col-sm-2">{{ fma_tech }}</div>
                        <div class="col-sm-1">{{ fma_date|date:"m/d/y" }}</div>
                        <div class="col-sm-2">{{ fma_status }}</div>
                        <div class="col-sm-2">{{ acres|floatformat:1 }}</div>
                    </div> 
                    {% if comments != 'None' %}
                        <div class="row"><div class="col-sm-12">Comments: {{ comments|linebreaks }}</div></div>
                    {% endif %}
                    </div>
                        <!------------------------------------REGEN TABLE-------------------------------------->
                        {% if overlap_fma in needs_regen_table %}<!--Only include the table if it's needed-->
                        <div class="row">
                            <div class="col-sm-4">&nbsp;</div>
                            <div class="col-sm-4">
                                <table>
                                <!-- <caption><strong>Seedlings Planted/Ordered</strong></caption> -->
                                    <tr>
                                        <th>Species</th>
                                        <th>Stock Type</th>
                                        <th>TPA</th>
                                        <!-- <th>Acres</th>
                                        <th>Stock Total</th> -->
                                    </tr>
                                    {% for row in regen %}
                                        {% if row.0 == overlap_fma %}
                                                <tr>
                                                    <td>{{ row.1 }}</td>
                                                    <td>{{ row.2 }}</td>
                                                    <td>{{ row.3 }}</td>
                                                    <!-- <td>{{ row.4|floatformat:2 }}</td>
                                                    <td>{{ row.5 }}</td> -->
                                                </tr>
                                            
                                        {% endif %}
                                    {% endfor %}
                                </table>
                            </div>
                        </div>
                        {% endif %}
                        <!-------------------------------------MATERIALS TABLE-------------------------------------------->
                        {% if overlap_fma in needs_materials_table %}.
                        <div class="row">
                                <div class="col-sm-4">&nbsp;</div>
                                <div class="col-sm-4">
                                    <table>
                                        <!-- <caption><strong>Materials Used</strong></caption> -->
                                        <tr>
                                            <th>Material Code</th>
                                            <th>Quantity/Acre</th>
                                            <th>Units</th>
                                        </tr>
                                        {% for row in material %}
                                            {% if row.0 == overlap_fma %}
                                                <tr>
                                                    <td>{{ row.6 }}</td>
                                                    <td>{{ row.3 }}</td>
                                                    <td>{{ row.2 }}</td>
                                                    
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    </table>
                                </div>
                            </div>
                        {% endif %}
                        <!-----------------------------------------SURVEY TABLE--------------------------------------------------->
                        {% if overlap_fma in needs_survey_table %}
                        <div class="row">
                                <div class="col-sm-4">&nbsp;</div>
                                <div class="col-sm-4">
                                    <table>
                                        <!-- <caption><strong>Survey Findings</strong></caption> -->
                                        <tr>
                                            <th>Species</th>
                                            <th>TPA&nbsp;All</th>
                                            <!-- <th>TPA Planted</th>
                                            <th>TPA Natural</th> -->
                                            <th>Damage</th>
                                            <th>DBH</th>
                                            <!-- <th>Crow Ratio</th>
                                            <th>Survival %</th> -->
                                        </tr>
                                        {% for row in survey %}
                                            {% if row.0 == overlap_fma %}
                                                <tr>
                                                    <td>{{ row.1 }}</td>
                                                    <td>{{ row.2 }}</td>
                                                    <!-- <td>{{ row.3 }}</td>
                                                    <td>{{ row.4 }}</td> -->
                                                    <td>{{ row.5 }}</td>
                                                    <td>{{ row.6 }}</td>
                                                    <!-- <td>{{ row.7 }}</td>
                                                    <td>{{ row.8 }}</td> -->
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    </table>
                                </div>
                            </div>
                        {% endif %}
                      
                    {% endif %}
                    {% endfor %}
                </div>
                
            </div>
            {% endfor %}   
            <div>This page intentionally left blank. </div><!--break-after will give us a blank page at the end.-->
            
    </body>
